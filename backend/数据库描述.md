# 资产管理系统(ZCGL)数据库详细说明文档

> 文档版本：1.0
> 生成日期：2026-02-13
> 数据库：zcgl (MySQL 101.37.236.101:3306)

---

## 一、数据库概述

本数据库(zcgl)是一个完整的资产管理系统数据库，支持多租户架构，包含资产全生命周期管理的所有核心功能模块。数据库采用utf8mb4字符集，支持完整的Unicode字符集，适用于中文环境下的资产信息管理。

### 1.1 设计原则

数据库整体设计遵循以下原则：

**多租户支持**
- 核心业务表均包含tenant_id字段实现数据隔离
- 每个租户拥有独立的数据空间
- 支持灵活的租户配置和模块权限管理

**完整的审计追踪机制**
- 记录数据的创建时间(created_at)和更新时间(updated_at)
- 记录创建人(created_by)和更新人(updated_by)
- 资产变更日志表(asset_change_logs)详细记录字段级变更历史

**灵活的状态管理机制**
- 通过枚举类型定义各种业务状态
- 支持工作流流转和审批流程
- 状态变更有时间戳和操作人记录

### 1.2 主要功能模块

系统目前支持的主要功能模块包括：

| 模块名称 | 主要功能 |
|---------|---------|
| 基础资产管理 | 资产分类、资产信息、折旧管理 |
| 资产盘点 | 盘点任务、盘点明细、差异处理 |
| 资产调配 | 调配申请、审批流程、位置更新 |
| 闲置发布 | 闲置资产发布、需求匹配 |
| 验收管理 | 验收申请、文件管理、电子签名 |
| 不良事件 | 事件报告、流程处理、附件管理 |
| 维护工单 | 维修保养、工单管理、成本核算 |
| 质量管理 | 计量管理、质控管理、预警提醒 |
| AI智能问答 | 对话会话、消息记录 |
| 系统配置 | 模块管理、租户配置、菜单管理 |

---

## 二、核心业务表

### 2.1 资产分类表(asset_categories)

#### 2.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | asset_categories |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产分类表 |

#### 2.1.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 分类ID |
| tenant_id | INT | YES | NULL | 租户ID |
| name | VARCHAR(100) | NO | - | 分类名称 |
| code | VARCHAR(50) | NO | - | 分类编码（唯一） |
| parent_id | INT | YES | 0 | 父分类ID |
| description | TEXT | YES | NULL | 分类描述 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 2.1.3 索引信息

| 索引名 | 索引类型 | 包含字段 |
|-------|---------|---------|
| PRIMARY | BTREE | id |
| code | BTREE | code |
| idx_tenant_id | BTREE | tenant_id |

#### 2.1.4 预置数据

| 编码 | 名称 | 父分类 | 描述 |
|-----|------|-------|------|
| YL | 医疗设备 | 0 | 医院医疗设备分类 |
| PT | 普通设备 | 0 | 普通设备分类 |
| FC | 房产建筑 | 0 | 房产建筑分类 |
| BG | 办公家具 | 0 | 办公家具分类 |
| YL-01 | 医疗影像设备 | YL | CT、MRI、X光机等 |
| YL-02 | 生命支持设备 | YL | 呼吸机、监护仪等 |
| YL-03 | 检验设备 | YL | 生化分析仪、血球仪等 |
| PT-01 | 办公设备 | PT | 电脑、打印机等 |
| PT-02 | 车辆 | PT | 各类车辆 |
| FC-01 | 建筑物 | FC | 各类建筑物 |
| FC-02 | 土地 | FC | 土地资产 |
| BG-01 | 办公桌椅 | BG | 办公桌椅 |
| BG-02 | 文件柜 | BG | 文件柜、储物柜 |

#### 2.1.5 业务说明

资产分类表采用自关联的树形结构设计，支持多级分类的无限嵌套。分类编码采用有意义的字母缩写，便于系统处理和人工识别。

**典型应用场景：**
- 按类别统计资产数量和价值
- 按类别进行资产折旧计算
- 按类别设置不同的维护周期和预警规则
- 资产新增时选择所属分类

---

### 2.2 资产主表(assets)

#### 2.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | assets |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产主表 |

#### 2.2.2 字段说明

**基础信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 资产ID（内部使用） |
| asset_code | VARCHAR(100) | NO | - | 资产编号（主编号，唯一标识） |
| code | VARCHAR(100) | YES | NULL | 原始编码code |
| code2 | VARCHAR(100) | YES | NULL | 原始编码code2 |
| code3 | VARCHAR(100) | YES | NULL | 原始编码code3 |
| asset_name | VARCHAR(200) | NO | - | 资产名称 |
| category_id | INT | NO | - | 分类ID |
| asset_type | ENUM | NO | - | 资产类型 |
| brand | VARCHAR(100) | YES | NULL | 品牌 |
| model | VARCHAR(100) | YES | NULL | 型号 |
| specification | TEXT | YES | NULL | 规格参数 |

**财务信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| purchase_date | DATE | YES | NULL | 购置日期 |
| purchase_price | DECIMAL(15,2) | YES | NULL | 购置价格 |
| current_value | DECIMAL(15,2) | YES | NULL | 当前价值 |
| depreciation_method | VARCHAR(50) | YES | NULL | 折旧方式 |
| depreciation_years | INT | YES | NULL | 折旧年限 |

**使用管理信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| location | VARCHAR(200) | YES | NULL | 存放位置 |
| department | VARCHAR(100) | YES | NULL | 使用部门 |
| unit | VARCHAR(200) | YES | NULL | 单位 |
| responsible_person | VARCHAR(50) | YES | NULL | 责任人 |
| status | ENUM | YES | 在用 | 资产状态 |
| supplier | VARCHAR(200) | YES | NULL | 供应商 |

**保修和备注**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| data_id | VARCHAR(100) | YES | NULL | 数据标识 |
| original_created_at | DATETIME | YES | NULL | 原始创建时间 |
| warranty_period | INT | YES | NULL | 保修期（月） |
| warranty_end_date | DATE | YES | NULL | 保修到期日 |
| remark | TEXT | YES | NULL | 备注 |

**审计字段**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| updated_by | VARCHAR(50) | YES | NULL | 更新人 |

#### 2.2.3 枚举值说明

**asset_type（资产类型）**
- 医疗设备
- 普通设备
- 房产建筑
- 办公家具
- 其他

**status（资产状态）**
- 在用
- 闲置
- 维修
- 报废
- 调配中

#### 2.2.4 索引信息

| 索引名 | 索引类型 | 包含字段 |
|-------|---------|---------|
| PRIMARY | BTREE | id |
| idx_category | BTREE | category_id |
| idx_type | BTREE | asset_type |
| idx_status | BTREE | status |
| idx_department | BTREE | department |
| idx_asset_code | BTREE | asset_code |

#### 2.2.5 业务说明

**重要说明：**
- asset_id字段不再使用，统一使用asset_code作为资产的主要标识
- code、code2、code3字段用于存储原始系统中的编码信息，确保数据迁移的完整性

**资产类型详解：**
- 医疗设备：CT、MRI、X光机等医疗专用设备
- 普通设备：电脑、打印机、车辆等通用设备
- 房产建筑：办公楼、厂房、土地等不动产
- 办公家具：办公桌椅、文件柜等办公设施
- 其他：不属于以上分类的其他资产

**折旧方法：**
支持多种折旧计算方法，如直线法、双倍余额递减法、年数总和法等。折旧年限根据资产类别和财务制度确定。

---

### 2.3 盘点记录表(inventory_records)

#### 2.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | inventory_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 盘点记录表 |

#### 2.3.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 盘点ID |
| inventory_no | VARCHAR(100) | NO | - | 盘点单号（唯一） |
| inventory_date | DATE | NO | - | 盘点日期 |
| inventory_type | ENUM | NO | - | 盘点类型 |
| inventory_person | VARCHAR(50) | NO | - | 盘点人 |
| status | ENUM | YES | 进行中 | 盘点状态 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 2.3.3 枚举值说明

**inventory_type（盘点类型）**
- 全面盘点：对所有资产进行全面盘点
- 抽查盘点：随机抽取部分资产进行盘点
- 专项盘点：针对特定类别或区域的盘点

**status（盘点状态）**
- 进行中
- 已完成
- 已取消

---

### 2.4 盘点明细表(inventory_details)

#### 2.4.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | inventory_details |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 盘点明细表 |

#### 2.4.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 明细ID |
| inventory_id | INT | NO | - | 盘点单ID |
| asset_id | INT | NO | - | 资产ID |
| expected_location | VARCHAR(200) | YES | NULL | 预期位置 |
| actual_location | VARCHAR(200) | YES | NULL | 实际位置 |
| expected_status | VARCHAR(50) | YES | NULL | 预期状态 |
| actual_status | VARCHAR(50) | YES | NULL | 实际状态 |
| discrepancy_type | ENUM | YES | 正常 | 差异类型 |
| discrepancy_desc | TEXT | YES | NULL | 差异说明 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |

#### 2.4.3 枚举值说明

**discrepancy_type（差异类型）**
- 正常：账实一致
- 位置不符：资产实际位置与记录不符
- 状态不符：资产实际状态与记录不符
- 缺失：资产未找到
- 多余：盘点时发现未记录的资产

#### 2.4.4 外键关系

| 字段名 | 引用表 | 引用字段 | 删除规则 |
|-------|--------|--------|---------|
| inventory_id | inventory_records | id | CASCADE |
| asset_id | assets | id | CASCADE |

---

### 2.5 资产调配表(transfer_records)

#### 2.5.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | transfer_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产调配表 |

#### 2.5.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 调配ID |
| transfer_no | VARCHAR(100) | NO | - | 调配单号（唯一） |
| asset_id | INT | NO | - | 资产ID |
| from_department | VARCHAR(100) | NO | - | 调出部门 |
| to_department | VARCHAR(100) | NO | - | 调入部门 |
| from_location | VARCHAR(200) | YES | NULL | 调出位置 |
| to_location | VARCHAR(200) | YES | NULL | 调入位置 |
| from_person | VARCHAR(50) | YES | NULL | 调出责任人 |
| to_person | VARCHAR(50) | YES | NULL | 调入责任人 |
| transfer_date | DATE | NO | - | 调配日期 |
| transfer_reason | TEXT | YES | NULL | 调配原因 |
| status | ENUM | YES | 待审批 | 调配状态 |
| approver | VARCHAR(50) | YES | NULL | 审批人 |
| approve_date | DATE | YES | NULL | 审批日期 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |

#### 2.5.3 枚举值说明

**status（调配状态）**
- 待审批
- 已批准
- 已完成
- 已取消

#### 2.5.4 外键关系

| 字段名 | 引用表 | 引用字段 | 删除规则 |
|-------|--------|--------|---------|
| asset_id | assets | id | CASCADE |

---

### 2.6 闲置资产发布表(idle_assets)

#### 2.6.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | idle_assets |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 闲置资产发布表 |

#### 2.6.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 发布ID |
| asset_id | INT | NO | - | 资产ID |
| publish_date | DATE | NO | - | 发布日期 |
| publish_person | VARCHAR(50) | NO | - | 发布人 |
| expected_use | VARCHAR(200) | YES | NULL | 期望用途 |
| contact_person | VARCHAR(50) | YES | NULL | 联系人 |
| contact_phone | VARCHAR(20) | YES | NULL | 联系电话 |
| status | ENUM | YES | 发布中 | 发布状态 |
| allocated_to | VARCHAR(100) | YES | NULL | 分配对象 |
| allocated_date | DATE | YES | NULL | 分配日期 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 2.6.3 枚举值说明

**status（发布状态）**
- 发布中
- 已分配
- 已取消

---

## 三、验收管理模块

### 3.1 验收申请表(acceptance_applications)

#### 3.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | acceptance_applications |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 验收申请表 |

#### 3.1.2 字段说明

**企业信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 申请ID |
| tenant_id | INT | YES | NULL | 租户ID |
| application_no | VARCHAR(50) | YES | NULL | 申请编号 |
| company_name | VARCHAR(200) | NO | - | 企业名称 |
| company_contact | VARCHAR(100) | YES | NULL | 企业联系人 |
| company_phone | VARCHAR(50) | YES | NULL | 企业联系电话 |
| company_address | TEXT | YES | NULL | 企业地址 |
| company_email | VARCHAR(100) | YES | NULL | 企业邮箱 |

**采购信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| purchase_department | VARCHAR(100) | YES | NULL | 采购部门 |
| use_department | VARCHAR(100) | YES | NULL | 使用部门 |

**资产信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| asset_name | VARCHAR(200) | NO | - | 资产名称 |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_brand | VARCHAR(100) | YES | NULL | 品牌 |
| asset_model | VARCHAR(100) | YES | NULL | 型号 |
| asset_specification | TEXT | YES | NULL | 规格 |
| purchase_date | DATE | YES | NULL | 采购日期 |
| purchase_amount | DECIMAL(15,2) | YES | NULL | 采购金额 |

**审批信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| status | ENUM | YES | 待审核 | 申请状态 |
| reviewer | VARCHAR(50) | YES | NULL | 审核人 |
| review_date | DATETIME | YES | NULL | 审核日期 |
| review_comment | TEXT | YES | NULL | 审核意见 |

**审计字段**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |

#### 3.1.3 枚举值说明

**status（申请状态）**
- 待审核
- 审核中
- 已通过
- 已拒绝
- 已验收

---

### 3.2 验收申请资产关联表(acceptance_application_assets)

#### 3.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | acceptance_application_assets |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 验收申请资产关联表 |

#### 3.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| application_id | INT | NO | - | 验收申请ID |
| asset_name | VARCHAR(200) | NO | - | 资产名称 |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_brand | VARCHAR(100) | YES | NULL | 品牌 |
| asset_model | VARCHAR(100) | YES | NULL | 型号 |
| asset_specification | TEXT | YES | NULL | 规格 |
| purchase_date | DATE | YES | NULL | 采购日期 |
| purchase_amount | DECIMAL(15,2) | YES | NULL | 采购金额 |
| order_index | INT | YES | 0 | 排序索引 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |

---

### 3.3 验收申请文件表(acceptance_application_files)

#### 3.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | acceptance_application_files |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 验收申请文件表 |

#### 3.3.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| application_id | INT | NO | - | 申请ID |
| file_type | ENUM | NO | - | 文件类型 |
| file_name | VARCHAR(255) | NO | - | 文件名 |
| file_path | VARCHAR(500) | NO | - | 文件路径 |
| file_size | BIGINT | YES | NULL | 文件大小（字节） |
| mime_type | VARCHAR(100) | YES | NULL | MIME类型 |
| uploaded_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 上传时间 |

#### 3.3.3 枚举值说明

**file_type（文件类型）**
- 安装图片
- 正常运行图片
- 安装报告单
- 采购合同
- 发票
- 其他资料

---

### 3.4 验收申请签字表(acceptance_application_signatures)

#### 3.4.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | acceptance_application_signatures |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 验收申请签字表 |

#### 3.4.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| application_id | INT | NO | - | 申请ID |
| signature_type | ENUM | NO | - | 签字类型 |
| signer_name | VARCHAR(50) | NO | - | 签字人姓名 |
| signer_department | VARCHAR(100) | YES | NULL | 签字人部门 |
| signer_company | VARCHAR(200) | YES | NULL | 签字人所属企业 |
| signature_file_path | VARCHAR(500) | YES | NULL | 签字图片路径 |
| signed_at | DATETIME | YES | NULL | 签字时间 |
| remark | TEXT | YES | NULL | 备注 |

#### 3.4.3 枚举值说明

**signature_type（签字类型）**
- 使用科室签字
- 职能部门签字
- 企业签字

---

### 3.5 资产验收记录表(asset_acceptance_records)

#### 3.5.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | asset_acceptance_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产验收记录表 |

#### 3.5.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| asset_id | INT | NO | - | 资产ID |
| asset_code | VARCHAR(100) | NO | - | 资产编号 |
| asset_name | VARCHAR(200) | NO | - | 资产名称 |
| supplier | VARCHAR(200) | YES | NULL | 销售企业/供应商 |
| acceptance_date | DATE | YES | NULL | 验收日期 |
| acceptance_person | VARCHAR(50) | YES | NULL | 验收人 |
| department | VARCHAR(100) | YES | NULL | 使用科室 |
| functional_department | VARCHAR(100) | YES | NULL | 职能部门 |
| status | ENUM | YES | 待验收 | 验收状态 |
| remark | TEXT | YES | NULL | 备注 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |

#### 3.5.3 枚举值说明

**status（验收状态）**
- 待验收
- 验收中
- 已验收
- 验收不合格

---

## 四、不良事件管理模块

### 4.1 不良事件记录表(adverse_reaction_records)

#### 4.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | adverse_reaction_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 不良事件记录表 |

#### 4.1.2 字段说明

**标识信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| report_no | VARCHAR(100) | NO | - | 报告编号 |
| asset_id | INT | YES | NULL | 资产ID |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_name | VARCHAR(200) | YES | NULL | 资产名称 |

**事件分类**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| report_type | ENUM | NO | - | 报告类型 |
| event_category | VARCHAR(100) | YES | NULL | 事件分类 |
| severity | ENUM | YES | 一般 | 严重程度 |
| event_consequence | ENUM | YES | NULL | 事件后果 |
| event_level | ENUM | YES | NULL | 事件等级 |

**事件详情**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| occurrence_date | DATETIME | NO | - | 发生时间 |
| discovery_date | DATETIME | YES | NULL | 发现时间 |
| location | VARCHAR(200) | YES | NULL | 发生地点 |
| department | VARCHAR(100) | YES | NULL | 发生科室 |
| involved_persons | TEXT | YES | NULL | 涉及人员（JSON） |
| reporter | VARCHAR(50) | NO | - | 上报人 |
| report_source | ENUM | YES | 系统上报 | 上报来源 |
| reporter_phone | VARCHAR(50) | YES | NULL | 上报人电话 |
| description | TEXT | NO | - | 事件描述 |

**原因分析**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| cause_analysis | TEXT | YES | NULL | 原因分析 |
| cause_category | ENUM | YES | NULL | 原因分类 |
| impact_assessment | TEXT | YES | NULL | 影响评估 |
| handling_measures | TEXT | YES | NULL | 处理措施 |
| prevention_measures | TEXT | YES | NULL | 预防措施 |
| improvement_suggestions | TEXT | YES | NULL | 改进建议 |

**处理信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| status | ENUM | YES | 待处理 | 处理状态 |
| handle_deadline | INT | YES | NULL | 处理时限（小时） |
| is_overdue | TINYINT(1) | YES | 0 | 是否超时 |
| handler | VARCHAR(50) | YES | NULL | 处理人 |
| handle_date | DATETIME | YES | NULL | 处理时间 |
| handle_result | TEXT | YES | NULL | 处理结果 |
| reviewer | VARCHAR(50) | YES | NULL | 审核人 |
| review_date | DATETIME | YES | NULL | 审核时间 |
| review_comment | TEXT | YES | NULL | 审核意见 |
| close_reason | TEXT | YES | NULL | 关闭原因 |

**特殊标记**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| is_serious | TINYINT(1) | YES | 0 | 是否严重事件 |
| reported_to_authority | TINYINT(1) | YES | 0 | 是否已上报监管部门 |
| authority_report_date | DATETIME | YES | NULL | 上报监管部门时间 |
| related_assets | TEXT | YES | NULL | 相关资产（JSON） |
| remark | TEXT | YES | NULL | 备注 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 4.1.3 枚举值说明

**report_type（报告类型）**
- 设备故障
- 安全事故
- 质量事故
- 使用异常
- 其他

**severity（严重程度）**
- 轻微
- 一般
- 严重
- 重大

**event_consequence（事件后果）**
- 无伤害
- 轻微伤害
- 中度伤害
- 重度伤害
- 死亡
- 设备损坏
- 其他

**event_level（事件等级）**
- I级
- II级
- III级
- IV级

**report_source（上报来源）**
- 系统上报
- 电话上报
- 邮件上报
- 现场上报
- 其他

**cause_category（原因分类）**
- 设备故障
- 操作失误
- 管理缺陷
- 环境因素
- 其他

**status（处理状态）**
- 待处理
- 处理中
- 已处理
- 已关闭
- 已归档

---

### 4.2 不良事件附件表(adverse_reaction_attachments)

#### 4.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | adverse_reaction_attachments |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 不良事件附件表 |

#### 4.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| record_id | INT | NO | - | 记录ID |
| file_name | VARCHAR(255) | NO | - | 文件名 |
| file_path | VARCHAR(500) | NO | - | 文件路径 |
| file_size | INT | YES | NULL | 文件大小（字节） |
| file_type | VARCHAR(50) | YES | NULL | 文件类型 |
| upload_time | TIMESTAMP | NO | CURRENT_TIMESTAMP | 上传时间 |

---

### 4.3 不良事件处理流程记录表(adverse_reaction_workflow)

#### 4.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | adverse_reaction_workflow |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 不良事件处理流程记录表 |

#### 4.3.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| record_id | INT | NO | - | 记录ID |
| step_name | VARCHAR(100) | NO | - | 步骤名称 |
| step_type | ENUM | NO | - | 步骤类型 |
| operator | VARCHAR(50) | NO | - | 操作人 |
| operation_time | DATETIME | NO | - | 操作时间 |
| operation_result | ENUM | YES | NULL | 操作结果 |
| comment | TEXT | YES | NULL | 操作意见 |
| next_handler | VARCHAR(50) | YES | NULL | 下一步处理人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |

#### 4.3.3 枚举值说明

**step_type（步骤类型）**
- 上报
- 处理
- 审核
- 关闭
- 归档

**operation_result（操作结果）**
- 通过
- 退回
- 拒绝
- 完成

---

## 五、维护管理模块

### 5.1 维护工单表(maintenance_workorders)

#### 5.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | maintenance_workorders |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 维护工单表 |

#### 5.1.2 字段说明

**基本信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 工单ID |
| tenant_id | INT | YES | 1 | 租户ID |
| work_order_no | VARCHAR(50) | NO | - | 工单编号 |
| asset_code | VARCHAR(50) | YES | NULL | 关联资产编号 |
| title | VARCHAR(200) | NO | - | 工单标题 |
| description | TEXT | YES | NULL | 工单描述 |
| priority | INT | YES | 3 | 优先级 |
| status | VARCHAR(20) | YES | pending | 状态 |

**时间计划**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| planned_start_date | DATETIME | YES | NULL | 计划开始时间 |
| planned_end_date | DATETIME | YES | NULL | 计划结束时间 |
| estimated_hours | DECIMAL(10,2) | YES | NULL | 预估工时 |
| actual_start_date | DATETIME | YES | NULL | 实际开始时间 |
| actual_end_date | DATETIME | YES | NULL | 实际结束时间 |
| actual_hours | DECIMAL(10,2) | YES | NULL | 实际工时 |

**人员分配**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| assigned_to | VARCHAR(50) | YES | NULL | 负责人 |
| assigned_by | VARCHAR(50) | YES | NULL | 分配人 |
| assigned_at | DATETIME | YES | NULL | 分配时间 |
| completed_by | VARCHAR(50) | YES | NULL | 完成人 |
| completed_at | DATETIME | YES | NULL | 完成时间 |

**费用材料**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| work_content | TEXT | YES | NULL | 实际工作内容 |
| materials | JSON | YES | NULL | 材料清单 |
| labor_cost | DECIMAL(12,2) | YES | 0 | 人工费 |
| outsourcing_cost | DECIMAL(12,2) | YES | 0 | 外包费 |
| other_cost | DECIMAL(12,2) | YES | 0 | 其他费用 |

**其他**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| cancel_reason | TEXT | YES | NULL | 取消原因 |
| remark | TEXT | YES | NULL | 备注 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | DATETIME | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | CURRENT_TIMESTAMP | 更新时间 |

#### 5.1.3 枚举值说明

**priority（优先级）**
- 1：紧急
- 2：高
- 3：中
- 4：低

**status（状态）**
- pending：待分配
- assigned：已分配
- in_progress：进行中
- pending_review：待审核
- completed：已完成
- closed：已关闭
- cancelled：已取消

---

### 5.2 维护工单材料表(maintenance_workorder_materials)

#### 5.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | maintenance_workorder_materials |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 维护工单材料表 |

#### 5.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| workorder_id | INT | NO | - | 工单ID |
| name | VARCHAR(200) | NO | - | 材料名称 |
| specification | VARCHAR(100) | YES | NULL | 规格型号 |
| quantity | DECIMAL(10,2) | NO | - | 数量 |
| unit_price | DECIMAL(12,2) | NO | - | 单价 |
| unit | VARCHAR(50) | YES | NULL | 单位 |
| supplier | VARCHAR(100) | YES | NULL | 供应商 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | DATETIME | YES | CURRENT_TIMESTAMP | 创建时间 |

---

## 六、质量管理模块

### 6.1 计量管理表(metrology_records)

#### 6.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | metrology_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 计量管理表 |

#### 6.1.2 字段说明

**基本信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| record_no | VARCHAR(100) | NO | - | 计量单号（唯一） |
| asset_id | INT | NO | - | 资产ID |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_name | VARCHAR(200) | YES | NULL | 资产名称 |
| metrology_type | ENUM | NO | - | 计量类型 |
| metrology_date | DATE | NO | - | 计量日期 |
| next_metrology_date | DATE | YES | NULL | 下次计量日期 |
| metrology_agency | VARCHAR(200) | YES | NULL | 计量机构 |
| certificate_no | VARCHAR(100) | YES | NULL | 证书编号 |

**计量结果**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| result | ENUM | YES | 待检 | 计量结果 |
| accuracy_level | VARCHAR(50) | YES | NULL | 准确度等级 |
| measurement_range | VARCHAR(100) | YES | NULL | 测量范围 |
| cost | DECIMAL(10,2) | YES | 0 | 计量费用 |
| operator | VARCHAR(50) | YES | NULL | 操作人 |
| remark | TEXT | YES | NULL | 备注 |

**周期配置**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| metrology_cycle | INT | YES | NULL | 计量周期（月） |
| warning_days | INT | YES | 30 | 预警天数 |
| certificate_validity_date | DATE | YES | NULL | 证书有效期 |
| is_auto_remind | TINYINT(1) | YES | 1 | 是否自动提醒 |

**审计字段**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| status | ENUM | YES | 待检 | 状态 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 6.1.3 枚举值说明

**metrology_type（计量类型）**
- 首次检定
- 周期检定
- 校准
- 期间核查
- 其他

**result（计量结果）**
- 合格
- 不合格
- 限用
- 待检

**status（状态）**
- 待检
- 进行中
- 已完成
- 已取消

---

### 6.2 计量附件表(metrology_attachments)

#### 6.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | metrology_attachments |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 计量附件表 |

#### 6.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| metrology_id | INT | NO | - | 计量记录ID |
| file_name | VARCHAR(255) | NO | - | 文件名 |
| file_path | VARCHAR(500) | NO | - | 文件路径 |
| file_size | INT | YES | NULL | 文件大小（字节） |
| file_type | VARCHAR(50) | YES | NULL | 文件类型 |
| upload_time | TIMESTAMP | YES | CURRENT_TIMESTAMP | 上传时间 |

---

### 6.3 质控管理表(quality_control_records)

#### 6.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | quality_control_records |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 质控管理表 |

#### 6.3.2 字段说明

**基本信息**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| record_no | VARCHAR(100) | NO | - | 质控单号（唯一） |
| asset_id | INT | NO | - | 资产ID |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_name | VARCHAR(200) | YES | NULL | 资产名称 |
| qc_type | ENUM | NO | - | 质控类型 |
| qc_date | DATE | NO | - | 质控日期 |
| next_qc_date | DATE | YES | NULL | 下次质控日期 |

**质控详情**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| qc_item | VARCHAR(200) | YES | NULL | 质控项目 |
| qc_method | VARCHAR(200) | YES | NULL | 质控方法 |
| qc_standard | VARCHAR(200) | YES | NULL | 质控标准 |
| result | ENUM | YES | 待检 | 质控结果 |
| qc_value | VARCHAR(100) | YES | NULL | 质控数值 |
| standard_value | VARCHAR(100) | YES | NULL | 标准值 |
| deviation | VARCHAR(100) | YES | NULL | 偏差 |
| operator | VARCHAR(50) | YES | NULL | 操作人 |
| reviewer | VARCHAR(50) | YES | NULL | 审核人 |
| review_date | DATE | YES | NULL | 审核日期 |
| remark | TEXT | YES | NULL | 备注 |

**周期配置**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| qc_cycle | INT | YES | NULL | 质控周期（月） |
| warning_days | INT | YES | 30 | 预警天数 |
| is_auto_remind | TINYINT(1) | YES | 1 | 是否自动提醒 |

**审计字段**

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| status | ENUM | YES | 待检 | 状态 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 6.3.3 枚举值说明

**qc_type（质控类型）**
- 日常质控
- 定期质控
- 专项质控
- 验收质控
- 其他

**result（质控结果）**
- 合格
- 不合格
- 待检
- 整改中

**status（状态）**
- 待检
- 进行中
- 已完成
- 已取消
- 整改中

---

### 6.4 质控附件表(quality_control_attachments)

#### 6.4.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | quality_control_attachments |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 质控附件表 |

#### 6.4.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| qc_id | INT | NO | - | 质控记录ID |
| file_name | VARCHAR(255) | NO | - | 文件名 |
| file_path | VARCHAR(500) | NO | - | 文件路径 |
| file_size | INT | YES | NULL | 文件大小（字节） |
| file_type | VARCHAR(50) | YES | NULL | 文件类型 |
| upload_time | TIMESTAMP | YES | CURRENT_TIMESTAMP | 上传时间 |

---

### 6.5 质量管理预警记录表(quality_management_alerts)

#### 6.5.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | quality_management_alerts |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 质量管理预警记录表 |

#### 6.5.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| alert_type | ENUM | NO | - | 预警类型 |
| record_id | INT | NO | - | 记录ID |
| asset_id | INT | NO | - | 资产ID |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_name | VARCHAR(200) | YES | NULL | 资产名称 |
| alert_date | DATE | NO | - | 预警日期 |
| due_date | DATE | NO | - | 到期日期 |
| days_remaining | INT | YES | NULL | 剩余天数 |
| alert_level | ENUM | YES | normal | 预警级别 |
| is_read | TINYINT(1) | YES | 0 | 是否已读 |
| is_handled | TINYINT(1) | YES | 0 | 是否已处理 |
| handled_by | VARCHAR(50) | YES | NULL | 处理人 |
| handled_at | DATETIME | YES | NULL | 处理时间 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 6.5.3 枚举值说明

**alert_type（预警类型）**
- metrology：计量
- quality_control：质控

**alert_level（预警级别）**
- normal：普通
- warning：警告
- urgent：紧急

---

### 6.6 质量管理周期配置表(quality_management_cycles)

#### 6.6.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | quality_management_cycles |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 质量管理周期配置表 |

#### 6.6.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| asset_id | INT | NO | - | 资产ID |
| asset_code | VARCHAR(100) | YES | NULL | 资产编号 |
| asset_name | VARCHAR(200) | YES | NULL | 资产名称 |
| metrology_cycle | INT | YES | NULL | 计量周期（月） |
| metrology_warning_days | INT | YES | 30 | 计量预警天数 |
| quality_control_cycle | INT | YES | NULL | 质控周期（月） |
| quality_control_warning_days | INT | YES | 30 | 质控预警天数 |
| is_auto_remind | TINYINT(1) | YES | 1 | 是否自动提醒 |
| remark | TEXT | YES | NULL | 备注 |
| created_by | VARCHAR(50) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

#### 6.6.3 约束信息

| 约束名 | 约束类型 | 字段 |
|-------|---------|------|
| uk_asset_id | UNIQUE | asset_id |

---

## 七、AI智能问答模块

### 7.1 AI对话会话表(ai_chat_sessions)

#### 7.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | ai_chat_sessions |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | AI对话会话表 |

#### 7.1.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 会话ID |
| tenant_id | INT | NO | - | 租户ID |
| user_id | INT | NO | - | 用户ID |
| session_name | VARCHAR(200) | YES | NULL | 会话名称 |
| created_at | TIMESTAMP | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | YES | NULL | 更新时间 |

---

### 7.2 AI对话消息表(ai_chat_messages)

#### 7.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | ai_chat_messages |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | AI对话消息表 |

#### 7.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | 消息ID |
| tenant_id | INT | NO | - | 租户ID |
| session_id | INT | NO | - | 会话ID |
| role | ENUM | NO | - | 角色 |
| content | TEXT | NO | - | 消息内容 |
| created_at | TIMESTAMP | YES | CURRENT_TIMESTAMP | 创建时间 |

#### 7.2.3 枚举值说明

**role（角色）**
- user：用户
- assistant：AI助手

---

## 八、运维管理模块

### 8.1 资产设备关联表(asset_device_mapping)

#### 8.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | asset_device_mapping |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产设备关联表 |

#### 8.1.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| asset_id | INT | NO | - | 资产ID |
| device_id | VARCHAR(100) | NO | - | 设备ID |
| bind_date | DATETIME | NO | - | 绑定日期 |
| unbind_date | DATETIME | YES | NULL | 解绑日期 |
| bind_person | VARCHAR(50) | YES | NULL | 绑定操作人 |
| unbind_person | VARCHAR(50) | YES | NULL | 解绑操作人 |
| bind_reason | TEXT | YES | NULL | 绑定原因 |
| is_active | TINYINT(1) | YES | 1 | 是否激活 |
| remark | TEXT | YES | NULL | 备注 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |

---

### 8.2 资产图片表(asset_images)

#### 8.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | asset_images |
| 引擎 | InnoDB |
| 字符集 | utf8 |
| 注释 | 资产图片表 |

#### 8.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | YES | NULL | 租户ID |
| asset_id | VARCHAR(100) | NO | - | 资产ID |
| file_id | VARCHAR(255) | NO | - | 文件ID |
| temp_file_url | VARCHAR(255) | YES | NULL | 临时文件URL |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |
| description | VARCHAR(255) | YES | NULL | 描述 |

---

### 8.3 资产变更日志表(asset_change_logs)

#### 8.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | asset_change_logs |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 资产变更日志表 |

#### 8.3.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| asset_id | INT | NO | - | 资产ID |
| field_name | VARCHAR(100) | NO | - | 变更字段名 |
| old_value | TEXT | YES | NULL | 旧值 |
| new_value | TEXT | YES | NULL | 新值 |
| changed_by | VARCHAR(100) | YES | NULL | 变更人 |
| changed_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 变更时间 |

---

## 九、系统管理模块

### 9.1 系统模块元数据表(system_modules)

#### 9.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | system_modules |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 系统模块元数据表 |

#### 9.1.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | VARCHAR(50) | NO | - | 模块ID |
| name | VARCHAR(100) | NO | - | 模块名称 |
| version | VARCHAR(20) | NO | - | 模块版本 |
| description | TEXT | YES | NULL | 模块描述 |
| category | VARCHAR(50) | NO | - | 模块分类 |
| type | VARCHAR(20) | NO | - | 模块类型 |
| status | VARCHAR(20) | NO | stable | 模块状态 |
| author | VARCHAR(100) | YES | NULL | 作者 |
| dependencies | TEXT | YES | NULL | 依赖关系 |
| compatibility | TEXT | YES | NULL | 兼容性规则 |
| frontend_config | TEXT | YES | NULL | 前端配置 |
| backend_config | TEXT | YES | NULL | 后端配置 |
| config_schema | TEXT | YES | NULL | 配置项定义 |
| default_config | TEXT | YES | NULL | 默认配置 |
| interfaces | TEXT | YES | NULL | 接口定义 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NO | 0000-00-00 00:00:00 | 更新时间 |

#### 9.1.3 索引信息

| 索引名 | 索引类型 | 包含字段 |
|-------|---------|---------|
| PRIMARY | BTREE | id |
| idx_category | BTREE | category |
| idx_status | BTREE | status |
| idx_type | BTREE | type |

---

### 9.2 租户模块配置表(tenant_module_configs)

#### 9.2.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | tenant_module_configs |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 租户模块配置表 |

#### 9.2.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | NO | - | 租户ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| enabled | TINYINT(1) | YES | 0 | 是否启用 |
| config | TEXT | YES | NULL | 模块配置 |
| version | VARCHAR(20) | YES | NULL | 配置版本 |
| enabled_at | TIMESTAMP | YES | NULL | 启用时间 |
| disabled_at | TIMESTAMP | YES | NULL | 禁用时间 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NO | 0000-00-00 00:00:00 | 更新时间 |

#### 9.2.3 约束和索引

| 索引名 | 索引类型 | 包含字段 |
|-------|---------|---------|
| PRIMARY | BTREE | id |
| uk_tenant_module | BTREE | tenant_id, module_id |
| idx_tenant_id | BTREE | tenant_id |
| idx_module_id | BTREE | module_id |
| idx_enabled | BTREE | enabled |

#### 9.2.4 外键关系

| 字段名 | 引用表 | 引用字段 | 删除规则 |
|-------|--------|--------|---------|
| tenant_id | tenants | id | CASCADE |
| module_id | system_modules | id | CASCADE |

---

### 9.3 模块配置版本表(module_config_versions)

#### 9.3.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | module_config_versions |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 模块配置版本表 |

#### 9.3.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| tenant_id | INT | NO | - | 租户ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| version | VARCHAR(20) | NO | - | 版本号 |
| config | TEXT | NO | - | 配置内容 |
| change_log | TEXT | YES | NULL | 变更日志 |
| created_by | VARCHAR(100) | YES | NULL | 创建人 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| is_current | TINYINT(1) | YES | 0 | 是否当前版本 |

---

### 9.4 模块依赖关系表(module_dependencies)

#### 9.4.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | module_dependencies |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 模块依赖关系表 |

#### 9.4.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| dependency_module_id | VARCHAR(50) | NO | - | 依赖模块ID |
| dependency_type | VARCHAR(20) | NO | - | 依赖类型 |
| min_version | VARCHAR(20) | YES | NULL | 最低版本 |
| max_version | VARCHAR(20) | YES | NULL | 最高版本 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |

#### 9.4.3 约束和索引

| 索引名 | 索引类型 | 包含字段 |
|-------|---------|---------|
| PRIMARY | BTREE | id |
| uk_module_dependency | BTREE | module_id, dependency_module_id |
| idx_module_id | BTREE | module_id |
| idx_dependency_module_id | BTREE | dependency_module_id |

---

### 9.5 系统模块菜单映射表(system_module_menus)

#### 9.5.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | system_module_menus |
| 引擎 | InnoDB |
| 字符集 | utf8mb4_unicode_ci |
| 注释 | 系统模块菜单映射表 |

#### 9.5.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| menu_key | VARCHAR(100) | NO | - | 菜单键 |
| is_enabled | TINYINT(1) | YES | 1 | 是否启用 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |

---

### 9.6 模块运行状态表(module_runtime_status)

#### 9.6.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | module_runtime_status |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 模块运行状态表 |

#### 9.6.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| tenant_id | INT | YES | NULL | 租户ID |
| status | VARCHAR(20) | NO | - | 运行状态 |
| health_status | VARCHAR(20) | YES | NULL | 健康状态 |
| last_heartbeat | TIMESTAMP | YES | NULL | 最后心跳时间 |
| error_message | TEXT | YES | NULL | 错误信息 |
| metrics | TEXT | YES | NULL | 运行指标 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NO | 0000-00-00 00:00:00 | 更新时间 |

---

### 9.7 模块操作日志表(module_operation_logs)

#### 9.7.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | module_operation_logs |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 模块操作日志表 |

#### 9.7.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| module_id | VARCHAR(50) | NO | - | 模块ID |
| tenant_id | INT | YES | NULL | 租户ID |
| operation | VARCHAR(50) | NO | - | 操作类型 |
| operator | VARCHAR(100) | YES | NULL | 操作人 |
| operation_data | TEXT | YES | NULL | 操作数据 |
| result | VARCHAR(20) | YES | NULL | 操作结果 |
| error_message | TEXT | YES | NULL | 错误信息 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 创建时间 |

---

## 十、位置管理模块

### 10.1 位置编码表(location_codes)

#### 10.1.1 表说明

| 属性 | 值 |
|-----|-----|
| 表名 | location_codes |
| 引擎 | InnoDB |
| 字符集 | utf8mb4 |
| 注释 | 位置编码表 |

#### 10.1.2 字段说明

| 字段名 | 类型 | 允许为空 | 默认值 | 注释 |
|-------|------|---------|--------|------|
| id | INT | NO | AUTO_INCREMENT | ID |
| location_code | VARCHAR(100) | NO | - | 位置编号（唯一） |
| location_name | VARCHAR(200) | NO | - | 位置名称 |
| description | TEXT | YES | NULL | 位置描述 |
| building_name | VARCHAR(200) | YES | NULL | 建筑物名称 |
| floor_number | INT | YES | NULL | 楼层号 |
| room_number | VARCHAR(100) | YES | NULL | 房间号 |
| area_name | VARCHAR(200) | YES | NULL | 区域名称 |
| latitude | DECIMAL(10,7) | YES | NULL | 纬度 |
| longitude | DECIMAL(10,7) | YES | NULL | 经度 |
| is_active | TINYINT(1) | YES | 1 | 是否激活 |
| created_at | TIMESTAMP | YES | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | YES | NULL | 更新时间 |

---

## 十一、表关系总览

### 11.1 核心业务关系

```
assets (资产主表)
├── asset_categories (分类)  [category_id -> id]
├── inventory_details (盘点明细)  [id -> asset_id]
├── transfer_records (调配记录)  [id -> asset_id]
├── idle_assets (闲置发布)  [id -> asset_id]
├── metrology_records (计量记录)  [id -> asset_id]
├── quality_control_records (质控记录)  [id -> asset_id]
├── quality_management_cycles (周期配置)  [id -> asset_id]
└── asset_change_logs (变更日志)  [id -> asset_id]
```

### 11.2 验收模块关系

```
acceptance_applications (验收申请)
├── acceptance_application_assets (资产关联)
├── acceptance_application_files (文件)
├── acceptance_application_signatures (签字)
└── asset_acceptance_records (验收记录)
    └── asset_acceptance_files (验收文件)
```

### 11.3 不良事件模块关系

```
adverse_reaction_records (不良事件记录)
├── adverse_reaction_attachments (附件)
└── adverse_reaction_workflow (处理流程)
```

### 11.4 维护模块关系

```
maintenance_workorders (维护工单)
└── maintenance_workorder_materials (材料明细)
```

### 11.5 质量管理模块关系

```
quality_management_cycles (周期配置)
├── metrology_records (计量记录)
│   └── metrology_attachments (计量附件)
├── quality_control_records (质控记录)
│   └── quality_control_attachments (质控附件)
└── quality_management_alerts (预警记录)
```

### 11.6 AI问答模块关系

```
ai_chat_sessions (对话会话)
└── ai_chat_messages (对话消息)
```

### 11.7 系统配置模块关系

```
system_modules (系统模块)
├── tenant_module_configs (租户配置)
│   └── module_config_versions (配置版本)
├── module_dependencies (模块依赖)
└── system_module_menus (菜单映射)

tenant_module_configs (租户模块配置)
└── module_runtime_status (运行状态)

system_module_menus (系统模块菜单)
└── menu_definitions (菜单定义) [menu_key]
```

---

## 十二、使用方法说明

### 12.1 基础数据维护

**分类数据维护**
```sql
-- 新增一级分类
INSERT INTO asset_categories (name, code, parent_id, description)
VALUES ('新分类', 'XC', 0, '新分类描述');

-- 新增子分类
INSERT INTO asset_categories (name, code, parent_id, description)
VALUES ('子分类', 'XC-01', (SELECT id FROM asset_categories WHERE code = 'XC'), '子分类描述');
```

**位置数据维护**
```sql
-- 新增位置
INSERT INTO location_codes (location_code, location_name, building_name, floor_number, room_number)
VALUES ('B1-101', '101房间', '主楼', 1, '101');
```

### 12.2 资产入库流程

```sql
-- 1. 创建验收申请
INSERT INTO acceptance_applications (
    application_no, company_name, asset_name, asset_brand,
    asset_model, purchase_date, purchase_amount, status
) VALUES (
    'YS202601010001', '供应商A', '新设备', '品牌X',
    '型号Y', '2026-01-01', 50000.00, '待审核'
);

-- 2. 验收通过后录入资产
INSERT INTO assets (
    asset_code, asset_name, category_id, asset_type, brand, model,
    purchase_date, purchase_price, location, department, status
) VALUES (
    'ZC001', '新设备', 1, '医疗设备', '品牌X', '型号Y',
    '2026-01-01', 50000.00, '主楼101', '科室A', '在用'
);
```

### 12.3 资产盘点流程

```sql
-- 1. 创建盘点任务
INSERT INTO inventory_records (
    inventory_no, inventory_date, inventory_type, inventory_person
) VALUES (
    'PD202601010001', '2026-01-01', '全面盘点', '管理员'
);

-- 2. 添加盘点明细（关联资产）
INSERT INTO inventory_details (
    inventory_id, asset_id, expected_location
) VALUES (
    1, 1, '主楼101'
);

-- 3. 更新盘点结果
UPDATE inventory_details
SET actual_location = '主楼102', discrepancy_type = '位置不符'
WHERE id = 1;
```

### 12.4 资产调配流程

```sql
-- 1. 创建调配申请
INSERT INTO transfer_records (
    transfer_no, asset_id, from_department, to_department,
    from_location, to_location, transfer_date, transfer_reason
) VALUES (
    'DP202601010001', 1, '科室A', '科室B',
    '主楼101', '主楼102', '2026-01-01', '工作需要'
);

-- 2. 审批通过后更新状态
UPDATE transfer_records
SET status = '已批准', approver = '审批人', approve_date = '2026-01-02'
WHERE id = 1;

-- 3. 调配完成更新资产信息
UPDATE transfer_records SET status = '已完成' WHERE id = 1;
UPDATE assets
SET department = '科室B', location = '主楼102'
WHERE id = 1;
```

### 12.5 维护工单流程

```sql
-- 1. 创建维护工单
INSERT INTO maintenance_workorders (
    work_order_no, asset_code, title, description,
    priority, status, planned_start_date, planned_end_date
) VALUES (
    'WO202601010001', 'ZC001', '定期保养', '设备定期保养维护',
    3, 'pending', '2026-01-02', '2026-01-03'
);

-- 2. 分配工单
UPDATE maintenance_workorders
SET assigned_to = '维修人员A', assigned_by = '管理员',
    assigned_at = NOW(), status = 'assigned'
WHERE id = 1;

-- 3. 开始工作
UPDATE maintenance_workorders
SET actual_start_date = NOW(), status = 'in_progress'
WHERE id = 1;

-- 4. 完成工作
UPDATE maintenance_workorders
SET actual_end_date = NOW(), status = 'pending_review',
    work_content = '已完成保养，更换滤网'
WHERE id = 1;

-- 5. 审核通过
UPDATE maintenance_workorders
SET status = 'completed', completed_by = '维修人员A', completed_at = NOW()
WHERE id = 1;
```

### 12.6 质量管理流程

**计量管理**
```sql
-- 1. 创建计量记录
INSERT INTO metrology_records (
    record_no, asset_id, asset_code, asset_name,
    metrology_type, metrology_date, metrology_agency
) VALUES (
    'JL202601010001', 1, 'ZC001', '设备A',
    '周期检定', '2026-01-01', '计量所'
);

-- 2. 记录计量结果
UPDATE metrology_records
SET result = '合格', certificate_no = 'ZJ20260001',
    next_metrology_date = DATE_ADD('2026-01-01', INTERVAL 1 YEAR),
    status = '已完成'
WHERE id = 1;
```

**预警处理**
```sql
-- 查看待处理预警
SELECT * FROM quality_management_alerts
WHERE is_handled = 0 ORDER BY alert_level DESC;

-- 处理预警
UPDATE quality_management_alerts
SET is_handled = 1, handled_by = '管理员',
    handled_at = NOW(), remark = '已完成计量'
WHERE id = 1;
```

### 12.7 常用查询示例

**按部门统计资产数量和价值**
```sql
SELECT
    department,
    COUNT(*) AS asset_count,
    SUM(purchase_price) AS total_value,
    SUM(current_value) AS current_value
FROM assets
WHERE status = '在用'
GROUP BY department;
```

**查询即将到期的保修资产**
```sql
SELECT
    asset_code, asset_name, department,
    warranty_end_date,
    DATEDIFF(warranty_end_date, CURDATE()) AS days_remaining
FROM assets
WHERE warranty_end_date IS NOT NULL
    AND warranty_end_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 30 DAY)
ORDER BY warranty_end_date;
```

**查询超期未盘点的资产**
```sql
SELECT a.*, MAX(i.inventory_date) AS last_inventory_date
FROM assets a
LEFT JOIN inventory_details id ON a.id = id.asset_id
LEFT JOIN inventory_records i ON id.inventory_id = i.id
GROUP BY a.id
HAVING last_inventory_date < DATE_SUB(CURDATE(), INTERVAL 1 YEAR)
    OR last_inventory_date IS NULL;
```

---

## 十三、索引优化建议

### 13.1 高频查询索引

| 表名 | 索引字段 | 查询场景 |
|-----|---------|---------|
| assets | category_id, status | 按分类和状态筛选 |
| assets | department, status | 按部门统计 |
| assets | asset_code | 精确查询 |
| inventory_records | inventory_date | 按日期查询 |
| inventory_details | inventory_id, asset_id | 盘点关联查询 |
| transfer_records | asset_id, status | 调配历史查询 |
| maintenance_workorders | asset_code, status, priority | 工单综合查询 |
| metrology_records | asset_id, next_metrology_date | 计量计划查询 |
| quality_control_records | asset_id, next_qc_date | 质控计划查询 |

### 13.2 复合索引建议

```sql
-- 资产分类统计
ALTER TABLE assets ADD INDEX idx_category_status (category_id, status);

-- 调配历史查询
ALTER TABLE transfer_records ADD INDEX idx_asset_status (asset_id, status);

-- 工单综合查询
ALTER TABLE maintenance_workorders ADD INDEX idx_asset_priority_status
    (asset_code, priority, status);
```

---

## 十四、数据安全与备份

### 14.1 数据安全策略

**多租户隔离**
- 所有业务表包含tenant_id字段
- 查询时必须带上tenant_id条件
- 数据权限基于租户进行控制

**审计追踪**
- 所有表包含created_at、updated_at字段
- 重要操作记录到审计日志
- 资产变更记录到asset_change_logs表

**敏感数据保护**
- 密码加密存储
- 个人信息脱敏处理
- 访问日志记录

### 14.2 备份策略

**备份频率**
- 全量备份：每日凌晨执行
- 增量备份：每小时执行
- 事务日志：实时备份

**备份存储**
- 本地磁盘：保留7天
- 远程存储：保留30天
- 归档存储：保留1年

### 14.3 恢复策略

```bash
# 全量恢复
mysql -u root -p zcgl < backup_full_2026-01-19.sql

# 基于时间点恢复
mysqlbinlog --stop-datetime="2026-01-19 12:00:00" zcgl-bin.000001 | mysql -u root -p
```

---

## 十五、附录

### 15.1 枚举值汇总

**资产类型(asset_type)**
| 值 | 说明 |
|---|------|
| 医疗设备 | 医疗专用设备 |
| 普通设备 | 通用设备 |
| 房产建筑 | 不动产 |
| 办公家具 | 办公设施 |
| 其他 | 其他类型 |

**资产状态(status)**
| 值 | 说明 |
|---|------|
| 在用 | 正常使用中 |
| 闲置 | 暂未使用 |
| 维修 | 维修中 |
| 报废 | 已报废 |
| 调配中 | 调配处理中 |

### 15.2 常用SQL片段

**获取资产完整分类路径**
```sql
WITH RECURSIVE category_path AS (
    SELECT id, name, code, parent_id, CAST(name AS CHAR(200)) AS path
    FROM asset_categories WHERE parent_id = 0
    UNION ALL
    SELECT c.id, c.name, c.code, c.parent_id,
           CONCAT(cp.path, ' > ', c.name)
    FROM asset_categories c
    INNER JOIN category_path cp ON c.parent_id = cp.id
)
SELECT * FROM category_path;
```

**统计各状态资产分布**
```sql
SELECT
    status,
    COUNT(*) AS count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM assets), 2) AS percentage
FROM assets
GROUP BY status
ORDER BY count DESC;
```

---

> 文档结束
